<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <title>SqlMan - Query Concept</title>
        <meta
            name="description"
            content="AJ Framework ä¸€ä¸ªåŸºäº SpringMVC æ„å»ºçš„è½»é‡çº§æ¡†æ¶ï¼Œæ—¨åœ¨å¢å¼º SpringMVC å¹¶ä½¿å…¶æ›´å…· SpringBoot çš„ç‰¹æ€§ã€‚å®ƒæ‹¥æœ‰è®¸å¤šå°å‹ç»„ä»¶ï¼Œéå¸¸æ˜“äºä½¿ç”¨ã€‚"/>
        <meta name="keywords" content="AJ Framework, ajaxjs, ajaxjs framework, java framework, web framewwork"/>
        <meta
        name="viewport" content="width=device-width, initial-scale=1"/> 
        <link rel="stylesheet" href="/style/docs/main.css"/>
        <link rel="icon" type="image/png" href="/asset/favicon.png"/>
        <script src="/asset/docs/js/common.js"></script>
    </head>
    <body>
        <nav>
            <div>
                <div class="links">
                    <a href="/">ğŸ  Home</a>
                    |
                                                        âš™ï¸ Source:
                    <a target="_blank" href="https://github.com/lightweight-component/SqlMan">Github</a>/<a target="_blank" href="https://gitcode.com/lightweight-component/SqlMan">Gitcode</a>
                    
                    | <a  href="/docs">English Version</a>
                </div>
                <h1>
                    <img src="/asset/favicon-2x.png" style="vertical-align: middle;height: 45px;margin-bottom: 6px;"/> SqlMan
                </h1>
                <h3>Lightweight Data Access Tools -- User Manual
                </h3>
            </div>
        </nav>
        <div>
            <menu>
                
                <ul>
                    <li class="selected">
                        <a href="/docs/cn">é¦–é¡µ</a>
                    </li>
                    <li>
                        <a href="/docs/quick-start-cn">å¿«é€Ÿå¼€å§‹</a>
                    </li>
                    <li>
                        <a href="/docs/setup-cn">å®‰è£…ä¸é…ç½®</a>
                    </li>
                </ul>
                <h3>æ•°æ®åº“æŸ¥è¯¢</h3>
                <ul>
                    <li>
                        <a href="/docs/query/query-concept-cn">åŸºç¡€æ¦‚å¿µ</a>
                    </li>
                    <li>
                        <a href="/docs/query/query-tutorial-cn">æŸ¥è¯¢æ•™ç¨‹</a>
                    </li>
                    <li>
                        <a href="/docs/query/query-paging-cn">åˆ†é¡µæŸ¥è¯¢</a>
                    </li>
                </ul>
                <h3>å†™å…¥æ•°æ®</h3>
                <ul>
                    <li>
                        <a href="/docs/write/Create-Update-Delete-cn">åˆ›å»º/ä¿®æ”¹/åˆ é™¤</a></li>
                    <li>
                        <a href="/docs/write/batch-cn">æ‰¹é‡æ›´æ–°</a>
                    </li>
                </ul>
                <h3>å…¶ä»–ç”¨æ³•</h3>
                <ul>
                    <li>
                        <a href="/docs/other/sql-xml-cn">SQL å†™åœ¨ XML ä¸­</a></li>
                    <li>
                        <a href="/docs/other/entity-cn">â€œç±»â€ ORM</a>
                    </li>
                </ul>
                <h3>Misc</h3>
                <ul>
                    <li><a href="/docs/common/versions-cn">æ›´æ–°å†å²</a></li>
                    <li><a href="/docs/common/contact-cn">è”ç³»</a></li>
                </ul>
            </menu>
            <article>
                <h1>XML ä¸­çš„ SQL</h1>
<h2>ä¸ºä»€ä¹ˆè¦åœ¨ XML ä¸­ä½¿ç”¨ SQLï¼Ÿ</h2>
<p>åƒè‘—åçš„ MyBatis æ¡†æ¶ä¸€æ ·ï¼ŒSQL è¯­å¥å¯ä»¥å­˜å‚¨åœ¨ XML æ–‡ä»¶ä¸­ã€‚è¿™ç§æ–¹å¼æœ‰å…¶ç‰¹å®šçš„åŸå› ã€‚ä»¥ä¸‹æ˜¯åœ¨ XML ä¸­å­˜å‚¨ SQL çš„ä¸€äº›ä¼˜ç‚¹ï¼š</p>
<ol>
<li><strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ï¼šå°† SQL è¯­å¥ä¿å­˜åœ¨ XML æ–‡ä»¶ä¸­æœ‰åŠ©äºå°† SQL é€»è¾‘ä¸ Java ä»£ç åˆ†ç¦»ã€‚è¿™ä½¿ä»£ç åº“æ›´åŠ æ•´æ´ï¼Œæ›´æ˜“äºç®¡ç†ã€‚</li>
<li><strong>å¯è¯»æ€§</strong>ï¼šå½“å­˜å‚¨åœ¨ XML ä¸­æ—¶ï¼Œé•¿ SQL è¯­å¥å¯ä»¥æ›´å…·å¯è¯»æ€§ã€‚XML æ–‡ä»¶çš„ç»“æ„å¯ä»¥å¸®åŠ©ä½¿ SQL æŸ¥è¯¢æ›´æœ‰æ¡ç†ï¼Œæ›´æ˜“äºç†è§£ã€‚</li>
<li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šå½“ SQL è¯­å¥å­˜å‚¨åœ¨ XML ä¸­æ—¶ï¼Œæ— éœ€æ›´æ”¹ Java ä»£ç å°±å¯ä»¥æ›´è½»æ¾åœ°æ›´æ–°å’Œç»´æŠ¤å®ƒä»¬ã€‚è¿™å¯¹äºå…·æœ‰å¤§é‡ SQL æŸ¥è¯¢çš„å¤§å‹é¡¹ç›®ç‰¹åˆ«æœ‰ç”¨ã€‚</li>
</ol>
<p>SqlMan åœ¨å¤„ç† SQL è¯­å¥æ–¹é¢é‡‡ç”¨äº†ç±»ä¼¼ MyBatis çš„æ–¹æ³•ã€‚</p>
<h2>å¦‚ä½•åœ¨ XML ä¸­ä½¿ç”¨ SQLï¼Ÿ</h2>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ classpath <code>/sql</code> ç›®å½•ä¸‹å®šä¹‰ä¸€ä¸ªåä¸º <code>sql.xml</code> çš„ XML æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å« SQL ç‰‡æ®µã€‚</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;root&gt;
    &lt;sql id=&quot;foo&quot;&gt;SELECT COUNT(*) AS total FROM shop_address&lt;/sql&gt;
    &lt;sql id=&quot;foo-2&quot;&gt;SELECT COUNT(*) AS total FROM shop_address WHERE id = ?&lt;/sql&gt;
    &lt;sql id=&quot;foo-3&quot;&gt;SELECT id FROM ${tableName} WHERE id = #{stat}&lt;/sql&gt;
    &lt;sql id=&quot;foo-4&quot;&gt;SELECT * FROM ${tableName} WHERE id = ?&lt;/sql&gt;
    &lt;sql id=&quot;foo-5&quot;&gt;
        &lt;if test=&quot;type=='address'&quot;&gt;
            SELECT COUNT(*) AS total FROM shop_address
        &lt;/if&gt;
        &lt;if test=&quot;type=='article'&quot;&gt;
            SELECT COUNT(*) AS total FROM ${tableName}
        &lt;/if&gt;
    &lt;/sql&gt;
    &lt;sql id=&quot;foo-6&quot;&gt;SELECT id FROM ${tableName} WHERE ${T(com.ajaxjs.sqlman.sql.TestXml).w()}&lt;/sql&gt;
&lt;/root&gt;

</code></pre>
<p>æ­¤æ–¹æ³•é€šè¿‡æ ‡è¯†ç¬¦ï¼ˆ<code>sqlId</code>ï¼‰æ‰§è¡Œ XML ç‰‡æ®µä¸­å®šä¹‰çš„ SQL è¯­å¥ï¼Œå¹¶è¿”å›åŒ…å«ç»“æœçš„ DAO å¯¹è±¡ã€‚</p>
<pre><code class="language-java">int result = new Sql(conn).inputXml(&quot;foo&quot;).queryOne(int.class); // è·å–ç¬¬ä¸€ä¸ªç»“æœ
System.out.println(result);
assertTrue(result &gt; 0);
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†å€¼å’Œå‚æ•°ï¼Œå¯ä»¥å°†ç›¸åŒçš„çŸ¥è¯†åº”ç”¨åˆ° XML æ–‡ä»¶ä¸­çš„è¯­å¥ã€‚</p>
<pre><code class="language-java">int result;
result = new Sql(conn).inputXml(&quot;foo-2&quot;, 1).queryOne(int.class);
assertEquals(1, result);

result = new Sql(conn).inputXml(&quot;foo-3&quot;, mapOf(&quot;tableName&quot;, &quot;shop_address&quot;, &quot;stat&quot;, 1)).queryOne(int.class);
assertEquals(1, result);

result = new Sql(conn).inputXml(&quot;foo-4&quot;, mapOf(&quot;tableName&quot;, &quot;shop_address&quot;, &quot;abc&quot;, 2), 1).queryOne(int.class);
System.out.println(result); // TODO, åº”è¯¥è¿”å› 0
</code></pre>
<p>æ­¤æ–¹æ³•é€šè¿‡æ ‡è¯†ç¬¦ï¼ˆsqlIdï¼‰æ‰§è¡Œ XML ç‰‡æ®µä¸­å®šä¹‰çš„ SQL è¯­å¥ï¼Œå¹¶ä½¿ç”¨é”®å€¼å¯¹å’Œå¯å˜å‚æ•°ã€‚</p>
<pre><code class="language-java">/**
 * æ‰§è¡Œ XML ç‰‡æ®µä¸­å®šä¹‰çš„ SQL è¯­å¥å¹¶è¿”å› DAO å¯¹è±¡ã€‚
 *
 * @param sqlId     ç”¨äºå®šä½ç‰¹å®š SQL è¯­å¥çš„ SQL æ ‡è¯†ç¬¦ã€‚
 * @param keyParams ç”¨äºæ›¿æ¢ SQL è¯­å¥ä¸­å˜é‡çš„é”®å€¼å¯¹å‚æ•°ã€‚
 * @param params    ç”¨äºæ›¿æ¢ SQL è¯­å¥ä¸­å ä½ç¬¦çš„å¯å˜å‚æ•°ã€‚
 * @return åŒ…å«ä»æ•°æ®åº“æ£€ç´¢çš„æ•°æ®çš„ DAO å¯¹è±¡ã€‚
 */
public DAO inputXml(String sqlId, Map&lt;String, Object&gt; keyParams, Object... params) {
    // æ‰§è¡Œ SQL å¹¶è¿”å› DAO å¯¹è±¡çš„å®ç°
}
</code></pre>
<h2>æ ‡ç­¾æ”¯æŒ</h2>
<p>å¯¹äºåŠ¨æ€ SQL ç”Ÿæˆï¼ŒSqlMan æ”¯æŒä»¥ä¸‹æ ‡ç­¾ï¼š<code>IF</code>ã€‚</p>
<pre><code class="language-xml">&lt;sql id=&quot;foo-5&quot;&gt;
    &lt;if test=&quot;type=='address'&quot;&gt;
        SELECT COUNT(*) AS total FROM shop_address
    &lt;/if&gt;
    &lt;if test=&quot;type=='article'&quot;&gt;
        SELECT COUNT(*) AS total FROM ${tableName}
    &lt;/if&gt;
&lt;/sql&gt;
</code></pre>
<p><code>test</code>å±æ€§ä¸­çš„å€¼æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¦‚<code>i &gt; 10</code>ã€‚å®ƒå¯ä»¥æ˜¯ç®€å•çš„å¸ƒå°”è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿”å›å¸ƒå°”å€¼çš„æ›´å¤æ‚è¡¨è¾¾å¼ã€‚ä»»ä½•ç¬¦åˆ Spring Expression æ¨¡å¼çš„è¡¨è¾¾å¼éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>æ›´å¤šæ ‡ç­¾å¦‚<code>if...else</code>ã€<code>foreach</code>æ­£åœ¨å¼€å‘ä¸­ã€‚</p>
<h2>è°ƒç”¨ Java æ–¹æ³•</h2>
<p>æŸäº›ä»»åŠ¡æ— æ³•ä»…é€šè¿‡ SQL å®Œæˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½è°ƒç”¨ Java æ–¹æ³•æ¥å®Œæˆä»»åŠ¡ã€‚SqlMan æ”¯æŒä½¿ç”¨è¯­æ³•<code>${T(com.ajaxjs.sqlman.sql.TestXml).w()}</code>åœ¨ SQL ä¸­è°ƒç”¨ Java æ–¹æ³•ã€‚</p>
<pre><code class="language-xml">&lt;sql id=&quot;foo-6&quot;&gt;SELECT id FROM ${tableName} WHERE ${T(com.ajaxjs.sqlman.sql.TestXml).w()}&lt;/sql&gt;
</code></pre>

            </article>
        </div>
        <footer>
    SqlMan, a part of <a href="https://framework.ajaxjs.com" target="_blank">AJ-Framework</a> open source. Mail:
    frank@ajaxjs.com, visit <a href="https://blog.csdn.net/zhangxin09" target="_blank">my blog(In Chinese)</a>.
    <br />
    <br />
     Copyright Â© 2025 Frank Cheung. All rights reserved.
</footer>
    </body>
</html>